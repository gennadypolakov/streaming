{"version":3,"sources":["../../../../js/cabinet/addGroup.js"],"names":["addGroup","el","length","find","on","e","getToken","$","currentTarget","data","toggleClass","html","get","r","vk_group_id","callback","width","height","left","window","screen","top","redirect_url","encodeURIComponent","location","hostname","url","wnd_vk","open","addEventListener","attachEvent","event","act","notify","message","group_id","token","btn","hasClass","formbutton","post","a","jQuery","parseJSON","status","wndConnect","iwindow","href","show_error"],"mappings":"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","file":"addGroup.js","sourcesContent":["class addGroup {\r\n    constructor(el) {\r\n        if (el.length) {\r\n            this.el = el;\r\n            this.el.find('.card').on('click','.add_group',(e)=>{\r\n                this.getToken($(e.currentTarget).data('group_id'),()=>{\r\n                    $(e.currentTarget).toggleClass('add_group');\r\n                    $(e.currentTarget).html('Отключить');\r\n                    $(e.currentTarget).toggleClass('remove_group');\r\n                    $(e.currentTarget).toggleClass('btn-success');\r\n                    $(e.currentTarget).toggleClass('btn-danger');\r\n                });\r\n            });\r\n            this.el.find('.card').on('click','.remove_group',(e)=>{\r\n                $.get('/ajax/group/remove',{'group_id':$(e.currentTarget).data('group_id')},(r)=>{\r\n                    $(e.currentTarget).toggleClass('add_group');\r\n                    $(e.currentTarget).html('Подключить');\r\n                    $(e.currentTarget).toggleClass('remove_group');\r\n                    $(e.currentTarget).toggleClass('btn-success');\r\n                    $(e.currentTarget).toggleClass('btn-danger');\r\n\r\n                });\r\n\r\n            });\r\n        }\r\n    }\r\n\r\n    getToken(vk_group_id,callback) {\r\n        let width = 750;\r\n        let height = 500;\r\n        let left = window.screen.width / 2 - width / 2;\r\n        let top = window.screen.height / 2 - height / 2;\r\n        let redirect_url = encodeURIComponent(`http://${window.location.hostname}/vk_group_token`);\r\n        let url = `https://oauth.vk.com/authorize?client_id=6665818&redirect_uri=${redirect_url}&group_ids=${vk_group_id}&display=page&scope=messages,manage,photos,docs&response_type=code&v=5.8&state=${vk_group_id}`;\r\n        let wnd_vk = window.open(url, \"Подключение группы\", \"width=\" + width + \",height=\" + height + \",status=no,directories=no,location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes,left=\" + left + \",top=\" + top);\r\n        window[window.addEventListener ? 'addEventListener' : 'attachEvent'](\r\n            (window.attachEvent ? 'on' : '') + 'message', (event) => {\r\n                switch (event.data.act) {\r\n                    case 'ErrorVkTokenGroup':\r\n                        notify(event.data.message,'danger');\r\n                        break;\r\n                    case 'SendVkTokenGroup':\r\n                        callback();\r\n                        break;\r\n                }\r\n            }, false\r\n        );\r\n    }\r\n\r\n    SendVkTokenGroup(vk_group_id, group_id, token, btn) {\r\n        if (!btn.hasClass('load')) {\r\n            btn.formbutton('start');\r\n            $.post('/ajax/youcarta_ru/group/token', {\r\n                group_id: group_id,\r\n                vk_group_id: vk_group_id,\r\n                token: token\r\n            }, (r) => {\r\n                let a = jQuery.parseJSON(r);\r\n                if (a.status === 'ok') {\r\n                    if (group_id !== 0) {\r\n                        this.wndConnect.iwindow('hide');\r\n                        this.get(this.el.data('id'));\r\n                    } else {\r\n                        location.href = '/cabinet/group/' + a.group_id;\r\n                    }\r\n                } else {\r\n                    this.wndConnect.iwindow('hide');\r\n                    this.show_error(a.message);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}